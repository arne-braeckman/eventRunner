# Story 1.1: Core Foundation Setup

## Status

Approved

## Story

**As a** development team,
**I want** to establish the foundational T3 Stack infrastructure with Convex database and Clerk authentication,
**so that** we have a working local development environment with basic user management and lead capture capabilities.

## Acceptance Criteria

1. T3 Stack application is initialized with Next.js 14, TypeScript, tRPC, Tailwind CSS
2. Convex database is configured and connected
3. Clerk authentication is configured with OAuth providers (Google, GitHub)
4. Basic user roles (Admin, Sales) are implemented
5. Basic lead capture form is functional and stores data in Convex
6. Local development environment is fully operational
7. Initial project structure follows architecture guidelines

## Tasks / Subtasks

- [x] Task 1: Initialize T3 Stack Application (AC: 1)

  - [x] Create T3 app with Next.js 15, TypeScript, tRPC, Tailwind CSS
  - [x] Configure initial project structure per architecture guidelines
  - [x] Verify Next.js 15 App Router is properly configured

- [x] Task 2: Set up Convex Database and Functions (AC: 2)

  - [x] Install and configure Convex CLI
  - [x] Create Convex schema with User and Contact models
  - [x] Set up database functions for user and contact operations
  - [x] Configure development environment variables

- [x] Task 3: Implement Clerk Authentication (AC: 3)

  - [x] Install and configure Clerk
  - [x] Set up OAuth providers (Google, GitHub)
  - [x] Create authentication configuration with JWT integration
  - [x] Implement signin/signout functionality

- [ ] Task 4: Implement User Role Management (AC: 4)

  - [ ] Create User model with role enumeration (Admin, Sales)
  - [ ] Implement role-based access control middleware
  - [ ] Create user management functions in Convex

- [x] Task 5: Create Basic Lead Capture Form (AC: 5)

  - [x] Create lead capture form component with validation
  - [x] Implement Contact model in Convex schema
  - [x] Create contact creation function
  - [x] Connect form to Convex mutations

- [ ] Task 6: Development Environment Setup (AC: 6)

  - [ ] Configure Convex environment variables for local development:
    - [ ] `CONVEX_DEPLOYMENT="your-convex-deployment"`
    - [ ] `NEXT_PUBLIC_CONVEX_URL="https://your-deployment.convex.cloud"`
    - [ ] `AUTH_GOOGLE_ID="your-google-client-id"`
    - [ ] `AUTH_GOOGLE_SECRET="your-google-client-secret"`
    - [ ] `AUTH_GITHUB_ID="your-github-client-id"`
    - [ ] `AUTH_GITHUB_SECRET="your-github-client-secret"`
    - [ ] `AUTH_RESEND_KEY="your-resend-api-key"`
  - [ ] Set up development scripts in package.json (build, dev, convex commands)
  - [ ] Verify all services are running locally (Next.js dev server, Convex dev)
  - [ ] Create basic routing structure with authentication routes

- [ ] Task 7: Testing Setup (AC: 7)
  - [ ] Configure Vitest for unit testing
  - [ ] Set up Playwright for E2E testing
  - [ ] Create initial test examples
  - [ ] Verify test runner configuration

## Dev Notes

### Previous Story Insights

This is the first story, so no previous insights exist.

### Data Models

**User Model** [Source: architecture/data-models.md#User]

- Uses Convex Auth for authentication management
- Role enumeration: ADMIN, SALES, PROJECT_MANAGER, STAFF, CLIENT
- Required fields: email (unique), name, role
- Optional fields: image, emailVerified

**Contact Model** [Source: architecture/data-models.md#Contact]

- Core entity for lead management
- Required fields: name, email, leadSource, leadHeat, status
- Status enumeration: UNQUALIFIED, PROSPECT, LEAD, QUALIFIED, CUSTOMER, LOST
- LeadSource enumeration: WEBSITE, FACEBOOK, INSTAGRAM, LINKEDIN, REFERRAL, DIRECT, OTHER

### API Specifications

**tRPC Router Structure** [Source: architecture/backend-architecture.md#tRPC]

- Located in `src/server/api/routers/`
- Contact router: contact.ts with create, read operations
- User router: user.ts with role management
- Protected procedures require authentication middleware

### Component Specifications

**Form Components** [Source: architecture/frontend-architecture.md#Component]

- Use react-hook-form for form handling
- Located in `src/components/forms/`
- Follow component template with TypeScript interfaces
- Use shadcn/ui base components

### File Locations

**Project Structure** [Source: architecture/unified-project-structure.md]

- Convex schema: `convex/schema.ts`
- Convex functions: `convex/`
- Next.js app: `src/app/`
- Components: `src/components/`
- tRPC routers: `src/server/api/routers/`
- Auth config: `convex/auth.config.ts`

### Testing Requirements

**Testing Strategy** [Source: architecture/testing-strategy.md]

- Unit tests with Vitest + React Testing Library
- E2E tests with Playwright
- Backend tests for tRPC procedures
- Test files location: `tests/` directory
- Component tests: `tests/components/`
- API tests: `tests/api/`

### Technical Constraints

**Technology Stack** [Source: architecture/tech-stack.md]

- Next.js 14.x with App Router
- TypeScript 5.x for type safety
- Convex for database and real-time features
- Convex Auth for authentication
- Tailwind CSS 3.x for styling
- shadcn/ui for component library

**Environment Configuration** [Source: architecture/development-workflow.md]

- Convex deployment configuration: `CONVEX_DEPLOYMENT` and `NEXT_PUBLIC_CONVEX_URL`
- OAuth provider configuration: `AUTH_GOOGLE_ID`, `AUTH_GOOGLE_SECRET`, `AUTH_GITHUB_ID`, `AUTH_GITHUB_SECRET`
- Email service configuration: `AUTH_RESEND_KEY`
- Environment variables must be configured before running `convex dev`

**Coding Standards** [Source: architecture/coding-standards.md]

- Always use TypeScript interfaces, never `any` type
- All API endpoints through tRPC routers with input validation
- Never query database directly from components
- Check user permissions in protected tRPC procedures
- Use Convex real-time subscriptions, not polling
- Access environment variables only through validated config objects

## Testing

### Testing Standards

**Test File Locations** [Source: architecture/testing-strategy.md#Test-Organization]

- Component tests: `tests/components/`
- API tests: `tests/api/`
- E2E tests: `e2e/`

**Testing Frameworks** [Source: architecture/testing-strategy.md#Testing-Pyramid]

- Frontend: Vitest + React Testing Library
- Backend: Vitest + Convex test utilities
- E2E: Playwright

**Specific Testing Requirements**

- Test authentication flow with Convex Auth
- Test form validation and submission
- Test user role management
- Test contact creation and storage
- E2E test for complete user signup and lead capture flow

## Change Log

| Date       | Version | Description                                                                                                         | Author              |
| ---------- | ------- | ------------------------------------------------------------------------------------------------------------------- | ------------------- |
| 2025-08-02 | 1.0     | Initial story creation for Epic 1 foundation setup                                                                  | Bob (Scrum Master)  |
| 2025-08-02 | 1.1     | Updated architecture references to reflect Convex migration (database-schema.md, unified-project-structure.md)      | Winston (Architect) |
| 2025-08-02 | 1.2     | Enhanced Task 6 with specific Convex environment variables and added Environment Configuration section to Dev Notes | Winston (Architect) |

## Dev Agent Record

### Agent Model Used

Claude Sonnet 4 (claude-sonnet-4-20250514)

### Debug Log References

[To be filled by dev agent]

### Completion Notes List

- Task 5: Implemented complete lead capture form system with:
  - LeadCaptureForm component with react-hook-form and zod validation
  - Full form validation for required fields (name, email, leadSource, leadHeat)
  - Integration with Convex mutations for contact creation
  - Real-time success/error feedback
  - Updated home page with Convex authentication components
  - Added contacts dashboard with recent contacts table

### File List

**Created:**
- `/src/components/forms/LeadCaptureForm.tsx` - Lead capture form component with validation

**Modified:**
- `/src/app/page.tsx` - Updated to use Convex authentication and include lead capture form
- `/package.json` - Added react-hook-form, @hookform/resolvers dependencies

## QA Results

[To be filled by QA agent]
